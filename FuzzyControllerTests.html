<!Doctype HTML>
<html>
<head>
	<META http-equiv="Content-Script-Type" content="text/javascript">
	<link rel="stylesheet" href="qunit.css">
	<script src="fuzzy.controller.js"></script>
	<script src="jquery.js"></script>
	<script src="qunit.js"></script>
	
</head>
<body>
	
 <div id="qunit"></div>
  <div id="qunit-fixture"></div>
  <script>
	var varX,varDX,varY;
	
	function setup(){

		varX = new FuzzyVariable();
		//add some fuzzy sets to it
		varX.L = new FuzzySet(0.3,0.4,0.5);
		varX.M = new FuzzySet(0.4,0.5,0.6);
		varX.H = new FuzzySet(0.5,0.6,0.7);
		
		varDX = new FuzzyVariable();
		//add some fuzzy sets to it
		varDX.L = new FuzzySet(0.3,0.4,0.5);
		varDX.M = new FuzzySet(0.4,0.5,0.6);
		varDX.H = new FuzzySet(0.5,0.6,0.7);

		varY = new FuzzyVariable();
		//add some fuzzy sets to it
		varY.L = new FuzzySet(0.3,0.4,0.5);
		varY.M = new FuzzySet(0.4,0.5,0.6);
		varY.H = new FuzzySet(0.5,0.6,0.7);
	}
	// FuzzySet tests
	
	test( "Test area calculations", function(){
		
		var set = new FuzzySet(0.4,0.5,0.6);
		equal(Math.floor(set.area()*100+0.5),10,"The fuzzy area of set is (0.4,0.5,0.6) is 0.1");

		set = new FuzzySet(0.1,0.5,0.9);
		equal(Math.floor(set.area()*100+0.5),40,"The fuzzy area of set is (0.1,0.5,0.9) is 0.4");

		set = new FuzzySet(0,0.5,1);
		equal(Math.floor(set.area()*100+0.5),50,"The fuzzy area of set is (0.1,0.5,0.9) is 0.5");
	});
	
	test("test calculate method", function() {
		var set = new FuzzySet(0.4,0.5,0.6);
		equal(Math.floor(set.calculate(0)),0,"The fuzzy value of 0 is 0");
		equal(Math.floor(set.calculate(0.4)),0,"The fuzzy value of 0.4 is 0");
		equal(Math.floor(set.calculate(0.45)*100+0.5),50,"The fuzzy value of 0.45 is 0.5");
		equal(Math.floor(set.calculate(0.5)*100+0.5),100,"The fuzzy value of 0.5 is 1");
		equal(Math.floor(set.calculate(0.55)*100+0.5),50,"The fuzzy value of 0.55 is 0.5");
		equal(Math.floor(set.calculate(0.6)*100+0.5),0,"The fuzzy value of 0.6 is 0");
		equal(Math.floor(set.calculate(0.7)*100+0.5),0,"The fuzzy value of 0.7  is 0");
		equal(Math.floor(set.calculate(1)*100+0.5),0,"The fuzzy value of 1 is 0");
	});
	

    test( "Fuzzification of value 0", function() {
		setup();
		varX.fuzzyfy(0.4);  
		//check the calculated fuzzy set value for each set
		equal(varX.L.value,1,"The fuzzy value for L at 0.4 is 1");
		equal(varX.M.value,0,"The fuzzy value for M at 0.4 is 0");
		equal(varX.H.value,0,"The fuzzy value for H at 0.4 is 0");
    });
	
	test( "Fuzzification of value 0.45", function() {
		setup();
		varX.fuzzyfy(0.45);
		equal(Math.floor(varX.L.value*10+0.5),5,"The fuzzy value for L at 0.25 is 0.5");
		equal(Math.floor(varX.M.value*10+0.5),5,"The fuzzy value for M at 0.25 is 0.5");
		equal(Math.floor(varX.H.value*10+0.5),0,"The fuzzy value for H at 0.25 is 0");
    });
	test( "Fuzzification of value 0.5", function() {
		setup();
		varX.fuzzyfy(0.5);
		equal(Math.floor(varX.L.value*10+0.5),0,"The fuzzy value for L at 0.5 is 0");
		equal(Math.floor(varX.M.value*10+0.5),10,"The fuzzy value for M at 0.5 is 1");
		equal(Math.floor(varX.H.value*10+0.5),0,"The fuzzy value for H at 0.5 is 0");
    });
	test( "Fuzzification of value 0.55", function() {
		setup();
		varX.fuzzyfy(0.55);
		equal(Math.floor(varX.L.value*10+0.5),0,"The fuzzy value for L at 0.55 is 0");
		equal(Math.floor(varX.M.value*10+0.5),5,"The fuzzy value for M at 0.55 is 0.5");
		equal(Math.floor(varX.H.value*10+0.5),5,"The fuzzy value for H at 0.55 is 0.5");
    });
	
	test( "Fuzzy rule fire test with undefined rule", function() {
		//calculate the set values and bind the sets to the variable
		setup();
		varX.fuzzyfy(0.45);
		varDX.fuzzyfy(0.4);
		
		varY.L.rule = new FuzzyRule([varX.L,varDX.L]);
		varY.M.rule = new FuzzyRule([varX.H,varDX.L]);
		//do not define a y.H rule
		varY.fireRules(); //fire all set rules for this variable
		
		//check the output fuzzy set values
		equal(Math.floor(varY.L.value*10+0.5),5,"The fuzzy output value y.L for rule L is 0.5");
		equal(varY.M.value,0,"The fuzzy output value for y.M rule L is 0");
		equal(varY.H.value,undefined,"The fuzzy output value for y.H rule L is undefined");
	});
	
	
	test( "Fuzzy rule fire test w/three rules", function() {
		
		//define fuzzy variables and their sets
		setup();
		//define the rules
		varY.L.rule = new FuzzyRule([varX.L,varDX.L]);
		varY.M.rule = new FuzzyRule([varX.M,varDX.M]);
		varY.H.rule = new FuzzyRule([varX.H,varDX.H]);
		
		//calculate the set values 
		varX.fuzzyfy(0.5);
		varDX.fuzzyfy(0.55);
		
		//fire all set rules for this variable
		varY.fireRules(); 
		
		//check the output fuzzy set values
		equal(varY.L.value,0,"The fuzzy output value rule y.L is 0");
		equal(Math.floor(varY.M.value*10+0.5),5,"The fuzzy output value for rule y.M is 0.5");
		equal(varY.H.value,0,"The fuzzy output value for rule y.H is ?");
	});
	

	
	test("test defuzzification method",function(){
		var varY = new FuzzyVariable();
		//add some fuzzy sets to it
		varY.L = new FuzzySet(0.3,0.4,0.5);
		varY.M = new FuzzySet(0.4,0.5,0.6);
		varY.H = new FuzzySet(0.5,0.6,0.7);
		
		
		varY.L.calculate(0.4);	
		varY.M.calculate(0);
		varY.H.calculate(0.6);
		
		outputVariable = varY.defuzzify();
		
		equal(outputVariable,0.5,"Centroid value should be 0.5");
		
		
		
	});

	

	
	
  </script>

</body>
</html>